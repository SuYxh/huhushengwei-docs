import{o as n,c as s,b as a}from"./app.157864df.js";const t='{"title":"14-能说说key的作用吗？","description":"","frontmatter":{},"headers":[{"level":2,"title":"14-能说说key的作用吗？","slug":"_14-能说说key的作用吗？"},{"level":3,"title":"分析：","slug":"分析："},{"level":3,"title":"思路分析：","slug":"思路分析："},{"level":3,"title":"回答范例：","slug":"回答范例："},{"level":3,"title":"知其所以然","slug":"知其所以然"},{"level":2,"title":"","slug":""}],"relativePath":"frame/vue/14-能说说key的作用吗.md","lastUpdated":1662433250869}',e={},p=[a('<h2 id="_14-能说说key的作用吗？">14-能说说key的作用吗？</h2><h3 id="分析：">分析：</h3><p>这是一道特别常见的问题，主要考查大家对虚拟DOM和patch细节的掌握程度，能够反映面试者理解层次。</p><hr><h3 id="思路分析：">思路分析：</h3><ol><li>给出结论，key的作用是用于优化patch性能</li><li>key的必要性</li><li>实际使用方式</li><li>总结：可从源码层面描述一下vue如何判断两个节点是否相同</li></ol><hr><h3 id="回答范例：">回答范例：</h3><ol><li>key的作用主要是为了更高效的更新虚拟DOM。</li><li>vue在patch过程中<strong>判断两个节点是否是相同节点是key是一个必要条件</strong>，渲染一组列表时，key往往是唯一标识，所以如果不定义key的话，vue只能认为比较的两个节点是同一个，哪怕它们实际上不是，这导致了频繁更新元素，使得整个patch过程比较低效，影响性能。</li><li>实际使用中在渲染一组列表时key必须设置，而且必须是唯一标识，应该避免使用数组索引作为key，这可能导致一些隐蔽的bug；vue中在使用相同标签元素过渡切换时，也会使用key属性，其目的也是为了让vue可以区分它们，否则vue只会替换其内部属性而不会触发过渡效果。</li><li>从源码中可以知道，vue判断两个节点是否相同时主要判断两者的key和元素类型等，因此如果不设置key，它的值就是undefined，则可能永远认为这是两个相同节点，只能去做更新操作，这造成了大量的dom更新操作，明显是不可取的。</li></ol><hr><h3 id="知其所以然">知其所以然</h3><p>测试代码，<a href="https://link.juejin.cn/?target=.%2Ftest-v3.html" target="_blank" rel="noopener noreferrer">test-v3.html</a></p><p>上面案例重现的是以下过程</p><p><img src="https://qn.huat.xyz/mac/20220828184511.awebp" alt="img"></p><p>不使用key</p><p><img src="https://qn.huat.xyz/mac/20220828184514.awebp" alt="image-20220214110059028"></p><hr><p>如果使用key</p><div class="language-js"><pre><code><span class="token comment">// 首次循环patch A</span>\n<span class="token constant">A</span> <span class="token constant">B</span> <span class="token constant">C</span> <span class="token constant">D</span> <span class="token constant">E</span>\n<span class="token constant">A</span> <span class="token constant">B</span> <span class="token constant">F</span> <span class="token constant">C</span> <span class="token constant">D</span> <span class="token constant">E</span>\n\n<span class="token comment">// 第2次循环patch B</span>\n<span class="token constant">B</span> <span class="token constant">C</span> <span class="token constant">D</span> <span class="token constant">E</span>\n<span class="token constant">B</span> <span class="token constant">F</span> <span class="token constant">C</span> <span class="token constant">D</span> <span class="token constant">E</span>\n\n<span class="token comment">// 第3次循环patch E</span>\n<span class="token constant">C</span> <span class="token constant">D</span> <span class="token constant">E</span>\n<span class="token constant">F</span> <span class="token constant">C</span> <span class="token constant">D</span> <span class="token constant">E</span>\n\n<span class="token comment">// 第4次循环patch D</span>\n<span class="token constant">C</span> <span class="token constant">D</span>\n<span class="token constant">F</span> <span class="token constant">C</span> <span class="token constant">D</span>\n\n<span class="token comment">// 第5次循环patch C</span>\n<span class="token constant">C</span> \n<span class="token constant">F</span> <span class="token constant">C</span>\n\n<span class="token comment">// oldCh全部处理结束，newCh中剩下的F，创建F并插入到C前面</span>\n复制代码\n</code></pre></div><hr><p>源码中找答案：</p><p>判断是否为相同节点</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fvuejs%2Fcore%2Fblob%2FHEAD%2Fpackages%2Fruntime-core%2Fsrc%2Fvnode.ts%23L342-L343" target="_blank" rel="noopener noreferrer">github1s.com/vuejs/core/…</a></p><p>更新时的处理</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fvuejs%2Fcore%2Fblob%2FHEAD%2Fpackages%2Fruntime-core%2Fsrc%2Frenderer.ts%23L1752-L1753" target="_blank" rel="noopener noreferrer">github1s.com/vuejs/core/…</a></p><hr><p>不使用key</p><p><img src="https://qn.huat.xyz/mac/20220828184519.awebp" alt="image-20220214110059028"></p><p>如果使用key</p><div class="language-js"><pre><code><span class="token comment">// 首次循环patch A</span>\n<span class="token constant">A</span> <span class="token constant">B</span> <span class="token constant">C</span> <span class="token constant">D</span> <span class="token constant">E</span>\n<span class="token constant">A</span> <span class="token constant">B</span> <span class="token constant">F</span> <span class="token constant">C</span> <span class="token constant">D</span> <span class="token constant">E</span>\n\n<span class="token comment">// 第2次循环patch B</span>\n<span class="token constant">B</span> <span class="token constant">C</span> <span class="token constant">D</span> <span class="token constant">E</span>\n<span class="token constant">B</span> <span class="token constant">F</span> <span class="token constant">C</span> <span class="token constant">D</span> <span class="token constant">E</span>\n\n<span class="token comment">// 第3次循环patch E</span>\n<span class="token constant">C</span> <span class="token constant">D</span> <span class="token constant">E</span>\n<span class="token constant">F</span> <span class="token constant">C</span> <span class="token constant">D</span> <span class="token constant">E</span>\n\n<span class="token comment">// 第4次循环patch D</span>\n<span class="token constant">C</span> <span class="token constant">D</span>\n<span class="token constant">F</span> <span class="token constant">C</span> <span class="token constant">D</span>\n\n<span class="token comment">// 第5次循环patch C</span>\n<span class="token constant">C</span> \n<span class="token constant">F</span> <span class="token constant">C</span>\n\n<span class="token comment">// oldCh全部处理结束，newCh中剩下的F，创建F并插入到C前面</span>\n复制代码\n</code></pre></div><p>源码中找答案：</p><p>判断是否为相同节点</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fvuejs%2Fcore%2Fblob%2FHEAD%2Fpackages%2Fruntime-core%2Fsrc%2Fvnode.ts%23L342-L343" target="_blank" rel="noopener noreferrer">github1s.com/vuejs/core/…</a></p><p>更新时的处理</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fvuejs%2Fcore%2Fblob%2FHEAD%2Fpackages%2Fruntime-core%2Fsrc%2Frenderer.ts%23L1752-L1753" target="_blank" rel="noopener noreferrer">github1s.com/vuejs/core/…</a></p><hr><h2 id=""></h2>',37)];e.render=function(a,t,e,c,o,l){return n(),s("div",null,p)};export default e;export{t as __pageData};
